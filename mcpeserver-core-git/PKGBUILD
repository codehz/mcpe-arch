pkgname=mcpeserver-core-git
pkgver=v0.1.5.r1.g9282c0c
pkgrel=3
pkgdesc="Minecraft PE Server Core"
arch=('x86_64')
license=('GPL')
depends=(lib32-glibc lib32-gcc-libs lib32-systemd)
provides=('mcpeserver-core')
makedepends=('mcpe-sdk' 'nimake' 'gcc' 'cmake')
source=('mcpeserver-core-git::git+https://github.com/codehz/bedrockserver#branch=master')
md5sums=('SKIP')
url='https://github.com/codehz/bedrockserver'

pkgver() {
  cd "$pkgname"
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$srcdir/$pkgname"
  git submodule init
  git submodule update
}

build() {
  cd "$srcdir/$pkgname"
  PATH=/opt/mcpe-sdk/bin:$PATH nimake clean -v 5
  PATH=/opt/mcpe-sdk/bin:$PATH nimake build -v 5
}

package() {
  install -Dm0755 "$srcdir/$pkgname/bin/bedrockserver" "$pkgdir/opt/mcpeserver-core/bedrockserver"
  install -Dm0755 "$srcdir/$pkgname/bin/bridge.so" "$pkgdir/opt/mcpeserver-core/bridge.so"
}
